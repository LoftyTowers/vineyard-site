<div class="relative bg-cover bg-center bg-no-repeat text-white py-24 px-4" [style.background-image]="heroImageUrl ? 'url(' + heroImageUrl + ')' : null">
  <button
    *ngIf="isEditMode"
    type="button"
    class="absolute top-4 right-4 bg-black/50 text-white rounded-full p-2 hover:bg-black/70 transition"
    aria-label="Edit hero image"
    (click)="openImagePicker()"
  >
    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
      <path d="M4 13.5V16h2.5L15.7 6.8l-2.5-2.5L4 13.5zm12.7-7.2a1 1 0 0 0 0-1.4l-1.6-1.6a1 1 0 0 0-1.4 0l-1.3 1.3 2.5 2.5 1.8-1.8z"/>
    </svg>
  </button>
  <div class="bg-black/50 p-8 rounded-md max-w-3xl mx-auto text-center">
    <h1 class="text-4xl md:text-6xl font-heading font-normal">
      <ng-container *ngIf="isEditMode; else heroTitleView">
        <textarea
          rows="1"
          class="w-full bg-transparent text-center outline-none resize-none"
          [(ngModel)]="heroTitle"
          (ngModelChange)="onHeadingChange('h1', $event)"></textarea>
      </ng-container>
      <ng-template #heroTitleView>{{ heroTitle }}</ng-template>
    </h1>
    <p class="text-xl md:text-2xl mt-4 mb-6 font-body">
      <ng-container *ngIf="isEditMode; else heroSubtitleView">
        <textarea
          rows="1"
          class="w-full bg-transparent text-center outline-none resize-none"
          [(ngModel)]="heroSubtitle"
          (ngModelChange)="onHeadingChange('h2', $event)"></textarea>
      </ng-container>
      <ng-template #heroSubtitleView>{{ heroSubtitle }}</ng-template>
    </p>
    <button class="bg-primary hover:bg-[#2E4D2F] text-white px-6 py-3 rounded-md shadow uppercase tracking-wider text-sm transition duration-200">Explore Our Wines</button>
  </div>
</div>

<div class="flex flex-col items-start gap-6 py-12 border-t border-gray-200">
  <div class="w-full space-y-4 font-body text-contrast">
    <ng-container *ngIf="isEditMode; else viewMode">
      <app-editable-text-block [(content)]="combinedContent" (contentChange)="onContentChange($event)" [editable]="true"></app-editable-text-block>
    </ng-container>
    <ng-template #viewMode>
      <div class="prose prose-neutral max-w-none home-richtext" [innerHTML]="combinedContent"></div>
    </ng-template>
  </div>
</div>

<ng-container *ngIf="isAdmin">
  <div class="w-full mt-10 border-t border-gray-200 pt-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <div class="text-xs text-gray-600">
      <ng-container *ngIf="autosaveState$ | async as autosave">
        <span *ngIf="autosave.status === 'dirty'">Unsaved changes</span>
        <span *ngIf="autosave.status === 'saving'">Saving…</span>
        <span *ngIf="autosave.status === 'saved'">
          Draft saved<span *ngIf="autosave.lastSavedUtc"> at {{ autosave.lastSavedUtc | date: 'HH:mm' }}</span>
        </span>
        <span *ngIf="autosave.status === 'error'">Autosave failed</span>
      </ng-container>
      <span *ngIf="hasDraft" class="ml-2 text-gray-500">Draft loaded</span>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      <button
        type="button"
        class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition"
        (click)="togglePreview()">
        {{ isPreviewing ? 'Edit' : 'Preview' }}
      </button>
      <button
        type="button"
        class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded disabled:opacity-50"
        [disabled]="!hasDraft || isPublishing"
        (click)="publishDraft()">
        {{ isPublishing ? 'Publishing…' : 'Publish draft' }}
      </button>
      <button
        type="button"
        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded disabled:opacity-50"
        [disabled]="!hasDraft || isPublishing"
        (click)="discardDraft()">
        Discard draft
      </button>
    </div>
  </div>
</ng-container>

<app-image-picker-dialog
  [isOpen]="isImagePickerOpen"
  (closed)="closeImagePicker()"
  (confirmed)="applyHeroImage($event)">
</app-image-picker-dialog>
